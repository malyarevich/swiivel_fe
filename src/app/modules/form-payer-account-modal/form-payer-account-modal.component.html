<app-modal
  class="form-payer-account"
  title="Create Payer Account"
  (closeModal)="onCloseFormPayerAccountModal()"
>
  <div
    *ngIf="!persons.length || !students.length"
    class="test-c d-flex justify-content-center overlay pt-5"
  >
    <div
      class="spinner-border text-light"
      role="status"
    >
      <span class="sr-only">
        Loading...
      </span>
    </div>
  </div>
  <div
    *ngIf="persons.length && students.length"
    class="form-payer-account-container"
  >
    <form
      [formGroup]="payerAccountForm"
    >
      <div
        class="form-payer-account-members"
      >
        <app-select-multi-search-field
          bindValue="id"
          bindLabel="name"
          formControlName="members"
          labelTitle="Members"
          [isInvalid]="payerAccountForm.get('members').invalid && payerAccountForm.get('members').touched"
          [items]="persons"
        >
        </app-select-multi-search-field>
        <div
          class="field-has-error"
          *ngIf="payerAccountForm.get('members').invalid && payerAccountForm.get('members').touched && payerAccountForm.get('members')['errors']['required']"
        >
          Members is required
        </div>
      </div>
      <div class="form-payer-account-label">
        Account
      </div>
      <div class="app-form-row">
        <div
          class="form-payer-account-account-name"
        >
          <app-input-field
            formControlName="name"
            label="Account name"
            [isInvalid]="payerAccountForm.get('name').invalid && payerAccountForm.get('name').touched"
          >
          </app-input-field>
          <div
            class="field-has-error"
            *ngIf="payerAccountForm.get('name').invalid && payerAccountForm.get('name').touched && payerAccountForm.get('name')['errors']['required']"
          >
            Account name is required
          </div>
        </div>
        <div class="form-payer-account-type">
          <app-select-field
            defaultItemIndex="Payer"
            formControlName="type"
            labelTitle="Type"
            [isInvalid]="payerAccountForm.get('type').invalid && payerAccountForm.get('type').touched"
            [items]="types"
          >
          </app-select-field>
          <div
            class="field-has-error"
            *ngIf="payerAccountForm.get('type').invalid && payerAccountForm.get('type').touched && payerAccountForm.get('type')['errors']['required']"
          >
            Type is required
          </div>
        </div>
      </div>
      <div
        class="form-payer-account-primary"
      >
        <app-checkbox-field
          label="Primary Payer Account"
          [hasMargin]="true"
          id="primary-account"
          formControlName="primary"
          [isInvalid]="payerAccountForm.get('primary').invalid && payerAccountForm.get('primary').touched"
        >
        </app-checkbox-field>
      </div>
      <div
        class="form-payer-account-members"
      >
        <app-select-multi-search-field
          bindValue="id"
          bindLabel="name"
          formControlName="recipients"
          labelTitle="Include fees of:"
          [isInvalid]="payerAccountForm.get('recipients').invalid && payerAccountForm.get('recipients').touched"
          [items]="students"
        >
        </app-select-multi-search-field>
        <div
          class="field-has-error"
          *ngIf="payerAccountForm.get('recipients').invalid && payerAccountForm.get('recipients').touched && payerAccountForm.get('recipients')['errors']['required']"
        >
          Students is required
        </div>
      </div>
      <div class="form-payer-account-fees">
        <app-form-payer-account-modal-fee
          *ngFor="let recipient of payerAccountForm.value['recipients']"
          [recipient]="recipient"
          [fees]="feesData"
          (removeRecipientFees)="onRemoveRecipient($event)"
          (updateFee)="updateFee($event)"
        ></app-form-payer-account-modal-fee>
      </div>
        <app-form-payer-account-modal-payment
          [parentForm]="payerAccountForm.get('paymentMethodsForm')"
          (onChangePaymentForm)="changePaymentForm($event)"
        ></app-form-payer-account-modal-payment>
      <div
        class="form-payer-account-members"
      >
        <app-select-multi-search-field
          bindValue="id"
          bindLabel="name"
          formControlName="receipt"
          labelTitle="Receipt"
          [isInvalid]="payerAccountForm.get('receipt').invalid && payerAccountForm.get('receipt').touched"
          [items]="persons"
        >
        </app-select-multi-search-field>
      </div>
      <p
        class="form-payer-account-has-error"
        [innerHTML]="this.errorMsg"
      >
      </p>
      <div
        class="form-payer-account-submit"
      >
        <button
          (click)="onCloseFormPayerAccountModal()"
          class="btn app-btn-outline-primary form-payer-account-cancel"
        >
          Cancel
        </button>

        <button
          type="button"
          class="btn app-btn-primary"
          (click)="onCreatePayerAccount()"
        >
          <!--[disabled]="payerAccountForm.invalid"-->
          Add Account
        </button>
      </div>
    </form>
  </div>
</app-modal>
