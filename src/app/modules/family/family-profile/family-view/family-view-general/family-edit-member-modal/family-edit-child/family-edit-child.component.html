<app-spinner *ngIf="!familyPerson || !familyPersons.length"></app-spinner>
<form [formGroup]="familyChildForm" (ngSubmit)="updateFamilyChild()" *ngIf="familyPerson && familyPersons.length">
  <p class="app-text-small font-weight-bold mb-1">PERSONAL {{familyPerson.person_role | uppercase}} INFO</p>
  <div class="row no-gutters app-family-card-body p-3">
    <div class="col-3 pl-2">
      <app-person-avatar-change (changeAvatarEmitter)="onChangeAvatar($event)"
                                [avatar]="familyPerson.person.avatar ? getAvatarUrl : ''"
                                [size]="'9em'">
      </app-person-avatar-change>
      <app-toggle-checkbox-field [formControlName]="'student'" label="Student"></app-toggle-checkbox-field>
    </div>
    <div class="col-9 mt-3">

      <div class="row no-gutters px-1">
        <div class="col-12 text-right" style="position: absolute">
          <app-checkbox-field
            label="Adopted"
            id="adopted"
            formControlName="adopted"
            [isInvalid]="familyChildForm.get('adopted').invalid && familyChildForm.get('adopted').touched"
          >
          </app-checkbox-field>
        </div>
      </div>

      <div class="row no-gutters mt-3 px-1">
        <div class="col-12">
          <app-select-multi-search-field
            bindValue="id"
            bindLabel="name"
            [formControlName]="'parents'"
            labelTitle="Parents"
            [isInvalid]="familyChildForm.get('parents').invalid && familyChildForm.get('parents').touched"
            [items]="familyPersons"
          >
          </app-select-multi-search-field>
        </div>
      </div>

      <div class="row no-gutters mt-3">
        <div class="col-4 px-1">
          <app-input-field [formControlName]="'first_name'"
                           id='first_name' label="First Name"
                           [isInvalid]="familyChildForm.get('first_name').invalid && familyChildForm.get('first_name').touched"></app-input-field>
          <div class="field-has-error app-position-relative"
               *ngIf="familyChildForm.get('first_name').invalid && familyChildForm.get('first_name').touched && familyChildForm.get('first_name')['errors']['required']"
          >
            First Name is required
          </div>
        </div>
        <div class="col-4 px-1">
          <app-input-field [formControlName]="'middle_name'" id='middle_name' label="Middle Name"></app-input-field>
        </div>
        <div class="col-4 px-1">
          <app-input-field [formControlName]="'last_name'" id='last_name' label="Last Name"></app-input-field>
        </div>
      </div>
      <div class="row no-gutters pt-2">
        <div class="col-4 px-1">
          <app-input-field [formControlName]="'legal_name'" id='legal_name' label="Legal Name"></app-input-field>
        </div>
        <div class="col-4 px-1">
          <div class="input-group app-input-container" [ngClass]="{'app-input-fill': familyChildForm.value.dob}">
            <label for="d1" class="app-input-label">Date of Birth</label>
            <input class="app-input app-family-input-datepicker form-control"
                   placeholder="Date of Birth"
                   name="dp1"
                   [formControlName]="'dob'"
                   [minDate]="minDate"
                   [maxDate]="maxDate"
                   ngbDatepicker
                   id="d1"
                   #d1="ngbDatepicker"
            >
            <div class="input-group-append">
              <button class="btn btn-outline-secondary calendar" (click)="d1.toggle()" type="button">
                <i class="far fa-calendar"></i>
              </button>
            </div>
          </div>
        </div>
        <div class="col-4 px-1">
          <app-input-field [formControlName]="'hebrew_dob'" id='hebrew_dob'
                           label="Hebrew Date of Birth"></app-input-field>
        </div>
      </div>
      <div class="row no-gutters pt-2">
        <div class="col-4 px-1">
          <app-input-field [formControlName]="'hebrew_full_name'" id='hebrew_full_name'
                           label="Full Hebrew Name"></app-input-field>
        </div>
        <div class="col-4 d-flex justify-content-between align-items-center">
          <label class="app-radio-container ml-1 mb-0">Son
            <input type="radio"
                   [name]="'gender'"
                   [value]="GENDER.MALE"
                   [formControlName]="'gender'">
            <span class="app-radio-checkmark"></span>
          </label>
          <label class="app-radio-container ml-1 mb-0">Daughter
            <input type="radio"
                   [name]="'gender'"
                   [value]="GENDER.FEMALE"
                   [formControlName]="'gender'">
            <span class="app-radio-checkmark"></span>
          </label>
        </div>
        <div class="col-4 pl-4">
          <app-toggle-checkbox-field [formControlName]="'deceased'" label="Deceased"></app-toggle-checkbox-field>
        </div>
      </div>
      <div *ngIf="familyChildForm.value.deceased" class="row no-gutters pt-2">
        <div class="offset-8 col-4 px-1 text-right">
          <div class="input-group app-input-container" [ngClass]="{'app-input-fill': familyChildForm.value.dod}">
            <label for="d2" class="app-input-label">Date of Death</label>
            <input class="app-input app-family-input-datepicker form-control"
                   placeholder="Date of Death"
                   name="dp2"
                   [formControlName]="'dod'"
                   [minDate]="minDate"
                   [maxDate]="maxDate"
                   ngbDatepicker
                   id="d2"
                   #d1="ngbDatepicker"
            >
            <div class="input-group-append">
              <button class="btn btn-outline-secondary calendar" (click)="d1.toggle()" type="button">
                <i class="far fa-calendar"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!--STUDENT INFO-->
  <div
    [hidden]="!familyChildForm.value.student || familyChildForm.value.deceased"
    formGroupName="person_info">
    <!--EDUCATION-->
    <p class="app-text-small font-weight-bold mb-1 mt-3">EDUCATION</p>
    <div class="row no-gutters app-family-card-body p-3">
      <div class="col-12">

        <div class="row no-gutters">
          <div class="col-3 px-1">
            <app-input-field [formControlName]="'student_current_grade'" id='current_grade'
                             label="Current Grade"></app-input-field>
          </div>
          <div class="col-3 px-1">
            <app-input-field [formControlName]="'student_start_grade'" id='start_grade'
                             label="Start Grade"></app-input-field>
          </div>
          <div class="col-6 px-1">
            <app-input-field [formControlName]="'student_current_school'" id='current_school'
                             label="Current School"></app-input-field>
          </div>
        </div>

        <div class="row no-gutters pt-2">
          <div class="col-12 px-1">
            <app-input-field [formControlName]="'student_previous_school'" id='previous_school'
                             label="Previous School Attended"></app-input-field>
          </div>
        </div>

      </div>
    </div>


    <!--MEDICAL-->
    <p class="app-text-small font-weight-bold mb-1 mt-3">MEDICAL</p>
    <div class="row no-gutters app-family-card-body p-3">
      <div class="col-12">

        <div class="row no-gutters">
          <div class="col-4 px-1">
            <app-input-field [formControlName]="'student_medical_conditions'" id='medical_conditions'
                             label="Medical Conditions"></app-input-field>
          </div>
          <div class="col-4 px-1">
            <app-input-field [formControlName]="'student_allergies'" id='allergies' label="Allergies"></app-input-field>
          </div>
          <div class="col-4 px-1">
            <app-input-field [formControlName]="'student_medications'" id='medications'
                             label="Medications"></app-input-field>
          </div>
        </div>

        <div class="row no-gutters pt-2">
          <div class="col-12 px-1">
            <app-input-field [formControlName]="'student_physician'" id='physician'
                             label="Physician"></app-input-field>
          </div>
        </div>

        <div class="row no-gutters pt-2">
          <div class="col-2 px-1">
            <app-input-field [formControlName]="'student_physician_country'" id='country'
                             label="Country"></app-input-field>
          </div>
          <div class="col-6 px-1">
            <app-input-field [formControlName]="'student_physician_address'" id='address'
                             label="Address"></app-input-field>
          </div>
          <div class="col-4 px-1">
            <app-input-field appNumbersValidator="true" regexStr="^[0-9]+$"
                             [formControlName]="'student_physician_phone'" id='phone'
                             label="Phone"></app-input-field>
          </div>
        </div>

      </div>
    </div>

    <!--EMERGENCY CONTACT-->
    <p class="app-text-small font-weight-bold mb-1 mt-3">EMERGENCY CONTACT</p>
    <div class="row no-gutters app-family-card-body p-3">
      <div class="col-12 px-1">
        <p class="app-text-small app-text-second mb-2">FIRST EMERGENCY CONTACT</p>
      </div>
      <div class="col-4 px-1">
        <app-input-field [formControlName]="'student_first_contact_relationship'" id='first_emergency_contact'
                         label="Emergency Contact"></app-input-field>
      </div>
      <div class="col-4 px-1">
        <app-input-field [formControlName]="'student_first_contact_full_name'" id='first_full_name'
                         label="Full Name"></app-input-field>
      </div>
      <div class="col-4 px-1">
        <app-input-field appNumbersValidator="true" regexStr="^[0-9]+$"
                         [formControlName]="'student_first_contact_cell_phone'" id='first_cell_phone'
                         label="Cell Phone"></app-input-field>
      </div>
    </div>
    <div class="row no-gutters app-family-card-body p-3 mt-2">
      <div class="col-12 px-1">
        <p class="app-text-small app-text-second mb-2">SECOND EMERGENCY CONTACT</p>
      </div>
      <div class="col-4 px-1">
        <app-input-field [formControlName]="'student_second_contact_full_name'" id='second_full_name'
                         label="Full name"></app-input-field>
      </div>
      <div class="col-4 px-1">
        <app-select-field class="app-text-capitalize"
                          [formControlName]="'student_second_contact_relationship'"
                          id='relationship_to_student'
                          labelTitle="Relationship to student"
                          [items]="roles">
        </app-select-field>
      </div>
      <div class="col-4 px-1">
        <app-input-field appNumbersValidator="true" regexStr="^[0-9]+$"
                         [formControlName]="'student_second_contact_cell_phone'" id='second_cell_phone'
                         label="Cell Phone"></app-input-field>
      </div>
    </div>

    <!--DOCUMENTS-->
    <app-family-student-documents [familyPerson]="familyPerson"></app-family-student-documents>

  </div>
  <!--END STUDENT INFO-->

  <div class="row pt-3">
    <div class="col-12 text-right">
      <button (click)="onCloseEditFamilyMemberModal()" class="btn app-btn-outline-primary mr-2">
        Cancel
      </button>
      <button type="submit" class="btn app-btn-primary" [disabled]="familyChildForm.invalid">
        Update
      </button>
    </div>
  </div>
</form>


